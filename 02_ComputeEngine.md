### ComputeEngineの概要
- IaaS (OS以上をカスタマイズ)
- 仮想マシン (VM)
- OS
  - Linux (Ubuntsu)
  - Windows
- 価格
  - インスタンス起動時間で秒単位の課金
  - 割引
    - 確約利用割引
      - 1~3年間の利用を事前確約する
      - 大幅な割引
      - キャンセル不可能
    - 継続利用割引
      - 実行時間が一定の割合を超えると自動的に割引適用
      - 最大3割引
    - プリエンプティブ仮想マシン
      - 最大8割引
      - 突然止まってもOKな処理に使用


### 偶発的なVM削除の防止
- deletionProtectionプロパティの設定 (削除からの母語)
  - `deletionProtection = True`の場合、権限っても削除できない


### 永続ディスク
- 長期的なネットワークストレージデバイス
- 複数の物理ディスクに分散される
- 永続ディスクはVMと独立して存在する
- DiskType
  - 標準永続ディスク (HDD)
    - コスト重視
  - バランス永続ディスク (SSD)
    - 若干高いが良い
    - 標準とSSD永続ディスクの中間
  - SSD永続ディスク(SSD)
    - 高スループット
    - レイテンシが低く、多くのIOPSを提供
  - エクストリーム永続ディスク (SSD)
    - ハイエンドDBワークフローに最適
- サイズが大きくなるほどパフォーマンスが高まる
  - 物理的には複数のStorageに分散されるため、並列処理が可能になる
- Local SSD
  - ホストするサーバに物理的に接続される
  - ローカルSSDのライフサイクルはVMと同じ
  - 冗長性は無いので注意


###　ストレージオプション
- ゾーン永続ディスク
  - VMと同じゾーンにある永続ディスク
  - 最もスタンダードな構成
- リージョン永続ディスク
  - 複数のゾーンにまたがって永続ディスクが存在
  - コストは2倍
- ローカルSSD
  - 高パフォーマンス
  - 一時的
  - 可用性、耐久性は低い
- Cloud Storage
  - object storage
  - レイテンシをあまり気にしない場合に選択
- Filestore
  - マウントして使用
  - コスト高め


### 永続ディスクのスナップショット
- snapshot (バックアップ)を作成することができる
  - global resource
  - VM実行中もスナップショット作成可能


### メンテナンスイベント
- VMを動かしているホストマシンのメンテナンスが定期的に行われる
- **ライブマイグレーション**による異なる物理サーバへの移動
- 2週間に1回程度行われている
- シミュレート可能
  - `gcloud compute instances simulate-maintenance-event INSTANCE=NAME --zone ZONE`


### マシンファミリーとマシンタイプ
- 汎用ファミリー
  - 価格とパフォーマンスのバランスが良い
  - 幅広いワークロードに最適
  - コア数、メモリを調整可能
- コンピューティング最適化
  - 1コアあたりのパフォーマンスが最高
  - レイテンシの影響を受けやすいものに適している（ゲーム、API)
- メモリ最適化
  - インメモリDBやインメモリデータ分析に適している
- GPU
  - A100など


### インスタンステンプレート
- 同じVMを作成可能
- マシンタイプ、ブートディスクイメージ(linuxなど)、コンテナイメージなどを作成
- グローバルリソース
- 無料


### Managed Instance Groupの作成
- 同一の複数VMをグループとして管理
- インスタンステンプレートに基づいて同じワークロードを作成
- 用途
  - ステートレスのワークロード
  - 高スループットのバッチ処理用ワークロード
  - ステートフルアプリケーション
- 利点
  - 高可用性
  - スケーラビリティ
  - 自動更新

- MIGの種類
  - stateless
  - statefull
  - 非MIG

### stateful MIG
- 状態の保持
- 自動スケーリングされない
- 永続ディスクはあるが、それぞれのインスタンスにアタッチされているだけ（共通のものを使用しているわけではない）


### 非マネージドインスタンスの概要ß
- ここのチューニングが必要なVMをグループ化する場合に便利
- 異なるワークロードをグループ化することは可能


### OSのパッチ適用
- VM Manager
  - OS Patch Management
    - OSのパッチ適用
  - OS Inventory Management
    - OS情報の収集
  - OS Configuration Management
    - ソフトウェアのインストール、削除
- 複数のVMを効率的にマネジメントする
- OS patch managent
  - OS Config agentがVMの中でアイドル状態
  - メタデータ有効化することでスタンバイする


### コマンドラインによるインスタンスの作成
```
gcloud compute instances create --machine-type=MACHINE-TYPE MACHINE_NAME
```


### インスタンスのサービスアカウント有効化
- VMが使用するアカウント
- 1つのVMに割り当てられるサービスアカウントは一つまで (VM:SA=多:1)


### プリエンプティブるVM
- 通常のインスタンスよりはるかに低価格であるが、インスタンスが停止する可能性がある
- 24時間実行したあとで必ずインスタンスを停止
