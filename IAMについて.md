### IAMの仕組み
- 複数の権限を**ロール**にまとめて、**プリンシパル**に付与する

- プリンシパル
  - 何らかのアカウント(Who)
  - Googleアカウント、サービスアカウント、など
- ロール
  - 権限の集合
  - プリンシパルに付与すると
- ポリシー
  - どのプリンシパルにどのロールを付与するかを定義する概念の集合(ロールバインディング)

### プリンシパル
- Googleアカウント
- サービスアカウント
  - アプリケーション用のアカウント
  - VMなんかに付与するもの
- Googleグループ
  - Googleアカウントとサービスアカウントのコレクション(束ねたもの)
  - 会社のチームで同一の権限が欲しい時などに使うと良い
- Google Workspaceアカウント
  - 組織ドメインに含まれるGoogleアカウント
  - Gmail, カレンダーなどのビジネスアプリのスイート
- Cloud Identity domain
  - デバイス、ディレクトリ、セキュリティなどを管理
- 認証済みのすべてのユーザ(allAuthenticatedUsers)
- すべてのユーザ(匿名)(allUsers)


### ロール
- ロールは権限のコレクション

- 基本ロール
  - 昔からあるやつ
  - オーナー、編集者など
  - 何千もの権限が含まれているので、本番環境での利用は推奨されない (**最小権限の原則**)

- 事前定義ロール
  - 基本ロールよりも詳細なアクセス制御が可能
  - 本番環境では事前定義ロールの利用が推奨される

- カスタムロール
  - 自分で作成
  - 削除されたロールは7~14日後に完全削除
  - サポートレベル　(GCPの状態)
    - Supported : カスタムロールで使える権限
    - Testing : β版の権限
    - Not Supported : 使えない権限
  - リリース段階
    - ALPHA : 未公開の権限が含まれている
    - BETA :　
    - GA : 権限は一般提供されている


### ポリシー
- policy は継承される（推移的）
  - 組織
  - フォルダ
  - プロジェクト
  - リソース
- policyは和集合で表される


### IAM APIの整合性モデル
- APIからデータを読み取るとき、**結果整合性**に基づく
  - データを書き込んだ直後にそのデータを読み取ると、古いデータが返される場合がある
  - 要は新しい設定変更をした場合には、反映までしばらく時間がかかるということ
- APIからデータを書き込むとき、**逐次整合性**に基づく
  - 書き込みオペレーションは常に受信した順番に処理される
- アプリケーションは切り捨て型指数バックオフでリクエストの再試行を行うことが推奨されている
  - 読み取りに失敗したら何回か繰り返してください。そして、その間隔を徐々に伸ばしてリトライすると結果整合性に基づいていつか返ってくるよ、ということを言っている

###
